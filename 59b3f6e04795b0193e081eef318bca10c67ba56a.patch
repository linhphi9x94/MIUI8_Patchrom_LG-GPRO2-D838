From 59b3f6e04795b0193e081eef318bca10c67ba56a Mon Sep 17 00:00:00 2001
From: wuxianlin <wuxianlinwxl@gmail.com>
Date: Thu, 29 Sep 2016 21:13:34 +0800
Subject: [PATCH] fix phone call

---
 .../smali/android/telecom/ParcelableCall.smali     | 115 +++++++++++++++++++++
 .../android/internal/telephony/Connection.smali    | 100 ++++++++++++++++++
 .../telephony/SubscriptionController.smali         |  16 +--
 3 files changed, 224 insertions(+), 7 deletions(-)

diff --git a/framework.jar.out/smali/android/telecom/ParcelableCall.smali b/framework.jar.out/smali/android/telecom/ParcelableCall.smali
index 9d270d7..b1d3655 100644
--- a/framework.jar.out/smali/android/telecom/ParcelableCall.smali
+++ b/framework.jar.out/smali/android/telecom/ParcelableCall.smali
@@ -294,6 +294,121 @@
     return-void
 .end method
 
+.method public constructor <init>(Ljava/lang/String;ILandroid/telecom/DisconnectCause;Ljava/util/List;IIJLandroid/net/Uri;ILjava/lang/String;ILandroid/telecom/GatewayInfo;Landroid/telecom/PhoneAccountHandle;ZLcom/android/internal/telecom/IVideoProvider;Ljava/lang/String;Ljava/util/List;Landroid/telecom/StatusHints;ILjava/util/List;Landroid/os/Bundle;Landroid/os/Bundle;)V
+    .locals 29
+    .param p1, "id"    # Ljava/lang/String;
+    .param p2, "state"    # I
+    .param p3, "disconnectCause"    # Landroid/telecom/DisconnectCause;
+    .param p5, "capabilities"    # I
+    .param p6, "properties"    # I
+    .param p7, "connectTimeMillis"    # J
+    .param p9, "handle"    # Landroid/net/Uri;
+    .param p10, "handlePresentation"    # I
+    .param p11, "callerDisplayName"    # Ljava/lang/String;
+    .param p12, "callerDisplayNamePresentation"    # I
+    .param p13, "gatewayInfo"    # Landroid/telecom/GatewayInfo;
+    .param p14, "accountHandle"    # Landroid/telecom/PhoneAccountHandle;
+    .param p15, "isVideoCallProviderChanged"    # Z
+    .param p16, "videoCallProvider"    # Lcom/android/internal/telecom/IVideoProvider;
+    .param p17, "parentCallId"    # Ljava/lang/String;
+    .param p19, "statusHints"    # Landroid/telecom/StatusHints;
+    .param p20, "videoState"    # I
+    .param p22, "intentExtras"    # Landroid/os/Bundle;
+    .param p23, "extras"    # Landroid/os/Bundle;
+    .annotation system Ldalvik/annotation/Signature;
+        value = {
+            "(",
+            "Ljava/lang/String;",
+            "I",
+            "Landroid/telecom/DisconnectCause;",
+            "Ljava/util/List",
+            "<",
+            "Ljava/lang/String;",
+            ">;IIJ",
+            "Landroid/net/Uri;",
+            "I",
+            "Ljava/lang/String;",
+            "I",
+            "Landroid/telecom/GatewayInfo;",
+            "Landroid/telecom/PhoneAccountHandle;",
+            "Z",
+            "Lcom/android/internal/telecom/IVideoProvider;",
+            "Ljava/lang/String;",
+            "Ljava/util/List",
+            "<",
+            "Ljava/lang/String;",
+            ">;",
+            "Landroid/telecom/StatusHints;",
+            "I",
+            "Ljava/util/List",
+            "<",
+            "Ljava/lang/String;",
+            ">;",
+            "Landroid/os/Bundle;",
+            "Landroid/os/Bundle;",
+            ")V"
+        }
+    .end annotation
+
+    .prologue
+    .local p4, "cannedSmsResponses":Ljava/util/List;, "Ljava/util/List<Ljava/lang/String;>;"
+    .local p18, "childCallIds":Ljava/util/List;, "Ljava/util/List<Ljava/lang/String;>;"
+    .local p21, "conferenceableCallIds":Ljava/util/List;, "Ljava/util/List<Ljava/lang/String;>;"
+    const-wide/16 v8, 0x0
+
+    const/16 v27, 0x0
+
+    move-object/from16 v1, p0
+
+    move-object/from16 v2, p1
+
+    move/from16 v3, p2
+
+    move-object/from16 v4, p3
+
+    move-object/from16 v5, p4
+
+    move/from16 v6, p5
+
+    move/from16 v7, p6
+
+    move-wide/from16 v10, p7
+
+    move-object/from16 v12, p9
+
+    move/from16 v13, p10
+
+    move-object/from16 v14, p11
+
+    move/from16 v15, p12
+
+    move-object/from16 v16, p13
+
+    move-object/from16 v17, p14
+
+    move/from16 v18, p15
+
+    move-object/from16 v19, p16
+
+    move-object/from16 v20, p17
+
+    move-object/from16 v21, p18
+
+    move-object/from16 v22, p19
+
+    move/from16 v23, p20
+
+    move-object/from16 v24, p21
+
+    move-object/from16 v25, p22
+
+    move-object/from16 v26, p23
+
+    invoke-direct/range {v1 .. v27}, Landroid/telecom/ParcelableCall;-><init>(Ljava/lang/String;ILandroid/telecom/DisconnectCause;Ljava/util/List;IIJJLandroid/net/Uri;ILjava/lang/String;ILandroid/telecom/GatewayInfo;Landroid/telecom/PhoneAccountHandle;ZLcom/android/internal/telecom/IVideoProvider;Ljava/lang/String;Ljava/util/List;Landroid/telecom/StatusHints;ILjava/util/List;Landroid/os/Bundle;Landroid/os/Bundle;Z)V
+
+    return-void
+.end method
+
 
 # virtual methods
 .method public describeContents()I
diff --git a/telephony-common.jar.out/smali/com/android/internal/telephony/Connection.smali b/telephony-common.jar.out/smali/com/android/internal/telephony/Connection.smali
index 8311d7a..054d61e 100644
--- a/telephony-common.jar.out/smali/com/android/internal/telephony/Connection.smali
+++ b/telephony-common.jar.out/smali/com/android/internal/telephony/Connection.smali
@@ -67,6 +67,8 @@
     .end annotation
 .end field
 
+.field private mLocalVideoCapable:Z
+
 .field protected mNumberConverted:Z
 
 .field protected mNumberPresentation:I
@@ -86,6 +88,8 @@
 
 .field public mPreHandoverState:Lcom/android/internal/telephony/Call$State;
 
+.field private mRemoteVideoCapable:Z
+
 .field mUserData:Ljava/lang/Object;
 
 .field private mVideoProvider:Landroid/telecom/Connection$VideoProvider;
@@ -584,9 +588,27 @@
     return v0
 .end method
 
+.method public isLocalVideoCapable()Z
+    .locals 1
+
+    .prologue
+    iget-boolean v0, p0, Lcom/android/internal/telephony/Connection;->mLocalVideoCapable:Z
+
+    return v0
+.end method
+
 .method public abstract isMultiparty()Z
 .end method
 
+.method public isRemoteVideoCapable()Z
+    .locals 1
+
+    .prologue
+    iget-boolean v0, p0, Lcom/android/internal/telephony/Connection;->mRemoteVideoCapable:Z
+
+    return v0
+.end method
+
 .method public isRinging()Z
     .locals 1
 
@@ -1044,6 +1066,84 @@
     return-void
 .end method
 
+.method public setLocalVideoCapable(Z)V
+    .locals 3
+    .param p1, "capable"    # Z
+
+    .prologue
+    iput-boolean p1, p0, Lcom/android/internal/telephony/Connection;->mLocalVideoCapable:Z
+
+    iget-object v2, p0, Lcom/android/internal/telephony/Connection;->mListeners:Ljava/util/Set;
+
+    invoke-interface {v2}, Ljava/util/Set;->iterator()Ljava/util/Iterator;
+
+    move-result-object v0
+
+    .local v0, "i$":Ljava/util/Iterator;
+    :goto_0
+    invoke-interface {v0}, Ljava/util/Iterator;->hasNext()Z
+
+    move-result v2
+
+    if-eqz v2, :cond_0
+
+    invoke-interface {v0}, Ljava/util/Iterator;->next()Ljava/lang/Object;
+
+    move-result-object v1
+
+    check-cast v1, Lcom/android/internal/telephony/Connection$Listener;
+
+    .local v1, "l":Lcom/android/internal/telephony/Connection$Listener;
+    iget-boolean v2, p0, Lcom/android/internal/telephony/Connection;->mLocalVideoCapable:Z
+
+    invoke-interface {v1, v2}, Lcom/android/internal/telephony/Connection$Listener;->onLocalVideoCapabilityChanged(Z)V
+
+    goto :goto_0
+
+    .end local v1    # "l":Lcom/android/internal/telephony/Connection$Listener;
+    :cond_0
+    return-void
+.end method
+
+.method public setRemoteVideoCapable(Z)V
+    .locals 3
+    .param p1, "capable"    # Z
+
+    .prologue
+    iput-boolean p1, p0, Lcom/android/internal/telephony/Connection;->mRemoteVideoCapable:Z
+
+    iget-object v2, p0, Lcom/android/internal/telephony/Connection;->mListeners:Ljava/util/Set;
+
+    invoke-interface {v2}, Ljava/util/Set;->iterator()Ljava/util/Iterator;
+
+    move-result-object v0
+
+    .local v0, "i$":Ljava/util/Iterator;
+    :goto_0
+    invoke-interface {v0}, Ljava/util/Iterator;->hasNext()Z
+
+    move-result v2
+
+    if-eqz v2, :cond_0
+
+    invoke-interface {v0}, Ljava/util/Iterator;->next()Ljava/lang/Object;
+
+    move-result-object v1
+
+    check-cast v1, Lcom/android/internal/telephony/Connection$Listener;
+
+    .local v1, "l":Lcom/android/internal/telephony/Connection$Listener;
+    iget-boolean v2, p0, Lcom/android/internal/telephony/Connection;->mRemoteVideoCapable:Z
+
+    invoke-interface {v1, v2}, Lcom/android/internal/telephony/Connection$Listener;->onRemoteVideoCapabilityChanged(Z)V
+
+    goto :goto_0
+
+    .end local v1    # "l":Lcom/android/internal/telephony/Connection$Listener;
+    :cond_0
+    return-void
+.end method
+
 .method public setConverted(Ljava/lang/String;)V
     .locals 1
     .param p1, "oriNumber"    # Ljava/lang/String;
diff --git a/telephony-common.jar.out/smali/com/android/internal/telephony/SubscriptionController.smali b/telephony-common.jar.out/smali/com/android/internal/telephony/SubscriptionController.smali
index 82008ff..afd316b 100644
--- a/telephony-common.jar.out/smali/com/android/internal/telephony/SubscriptionController.smali
+++ b/telephony-common.jar.out/smali/com/android/internal/telephony/SubscriptionController.smali
@@ -970,20 +970,22 @@
 
     .line 300
     .local v14, "countryIso":Ljava/lang/String;
-    const-string/jumbo v1, "user_network_mode"
+    #const-string/jumbo v1, "user_network_mode"
 
     .line 299
-    move-object/from16 v0, p1
+    #move-object/from16 v0, p1
 
-    invoke-interface {v0, v1}, Landroid/database/Cursor;->getColumnIndexOrThrow(Ljava/lang/String;)I
+    #invoke-interface {v0, v1}, Landroid/database/Cursor;->getColumnIndexOrThrow(Ljava/lang/String;)I
 
-    move-result v1
+    #move-result v1
 
-    move-object/from16 v0, p1
+    #move-object/from16 v0, p1
 
-    invoke-interface {v0, v1}, Landroid/database/Cursor;->getInt(I)I
+    #invoke-interface {v0, v1}, Landroid/database/Cursor;->getInt(I)I
 
-    move-result v15
+    #move-result v15
+    
+    const/16 v15, -0x1
 
     .line 303
     .local v15, "userNwMode":I
